package kr.co.hanshinit.NeoCMS.cmm.util;


import javax.mail.Address;
import javax.mail.SendFailedException;
import org.apache.commons.mail.SimpleEmail;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.messaging.MessagingException;

public class EmailUtil {
  
  private final static Logger logger = LoggerFactory.getLogger(EmailUtil.class);
  
  // 비밀번호는 개인 메일이므로 공개할 수 없다.
  // 유지보수시 문제가 있다면 한누비, 아이원, 부천 여청재단 담당자에게 욕할 것.
  private static final String HOSTNAME = "smtp.daum.net";
  private static final int SMTP_PORT = 456;
  private static final String FROM = "no_reply_dev@daum.net";
  private static final String PWD = "";
  
  public static void sendEmail(SimpleEmail email) {
    
    try {
      email.setHostName(HOSTNAME);
      email.setSmtpPort(SMTP_PORT);
      email.setAuthentication(FROM, PWD);
      email.setSSLOnConnect(true);
      email.setStartTLSEnabled(true);
      
      // 한글
      email.setCharset("euc-kr");
      
      //  보내는 주소
      email.setFrom(FROM, "[부천여성청소년재단 알림]");
      
      // 메일 전송
      email.send();
    }catch (MessagingException me) {
      logger.error("\n\t>> MessagingException <<\n\n");
      StringUtil.printException( me, true );
      Exception ex = me;
      if (ex instanceof SendFailedException) {
      SendFailedException sfex = (SendFailedException)ex;
      Address[] invalid = sfex.getInvalidAddresses();
      if (invalid != null) {
        logger.error(" ** Invalid Addresses");
        if (invalid != null) {
          for (int i = 0; i < invalid.length; i++)
            logger.error(" " + invalid[i]);
          }
        }
      }
      logger.error("\n\t>> MessagingException <<\n\n");
    } catch( Exception e ) {
      logger.error( "{}", StringUtil.printException( e ) );
    }
  }

}
